@model WorkoutHunterV2.Models.DbModels.ForIndex
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- <link href ="main.css" rel="stylesheet" type="text/css"> -->

    <title>Main</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <link href='https://fonts.googleapis.com/css?family=Press+Start+2P' rel='stylesheet' type='text/css'>
    <!-- include rpgui -->
    <link href="~/student/main.css" rel="stylesheet" type="text/css">
    <script src="~/student/rpgui.js"></script>
    <script src="jquery-3.5.1.min.js"></script>
</head>
<body>
    <div id="myCanvus">

        <div class="Rank">
            <div id="rankIcon">
                <div id="rankLV">
                    <p>Rank @Model.Class</p>
                </div>
            </div>
        </div>
    </div>

    <div class="topLeft">
        <div id="idNum">
            <p>ID:@Model.Uid</p>
        </div>
        <div id="money">
            <p>$:@Model.Money</p>
        </div>
    </div>


    <div class="topCenter">
        <div id="str">
            <p>STR:@Model.Strength</p>
        </div>
        <div id="vit">
            <p>VIT:@Model.Vitality</p>
        </div>
        <div id="agi">
            <p>AGI:@Model.Agility</p>
        </div>
    </div>

    <div id="bottom_obj">
        <div id="potion_col"></div>
        <div id="skill_col"></div>
    </div>






    <div class="LeftObj">
        <div id="itemBox">
            <a href="javascript:void(0)" onclick="document.getElementById('openBag').style.display='block';" class="Btn">
                <img id="boxImg" src="~/student/img/box.png">
            </a>

            <div class="rpgui-content" id="openBag">
                <div class="rpgui-container framed rpgui-draggable" id="inventory">
                    <div style="height: 10%;"><a href="javascript:void(0)" onclick="document.getElementById('openBag').style.display='none';">Close</a></div>
                    <div class="selectBar">

                        <select class="rpgui-dropdown">
                            <option selected>Potion</option>
                            <option>Weapon</option>
                            <option>Sheild</option>
                            <option>Scroll</option>
                            <option>Item</option>
                        </select>
                    </div>


                    <hr />


                    @{
                        int index = 0;
                        int tempNumber = 0;
                        for (int i = 0; i < 30; i++)
                        {
                            if (i != 0 && i % 6 == 0)
                            {
                                <br /><br />
                            };
                            <div class="rpgui-icon empty-slot">
                                @if (index < ViewBag.Items.Count)
                                {
                                    if (i < ViewBag.Items[index].quantity + tempNumber - 1)
                                    {
                                        <div class="itemImg item_001 Btn" onclick="pdItem(this)" style="background-image:url('/student/xMallPic/@ViewBag.Items[index].Item.ItemPic')">
                                            <div class="disc">
                                                <div class="rpgui-container framed-grey" style="width:100%; height:100%; left:0px; top:0px;">
                                                    <label>@ViewBag.Items[index].Item.ItemInfo</label>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="itemImg item_001 Btn" onclick="pdItem(this)" style="background-image:url('/student/xMallPic/@ViewBag.Items[index].Item.ItemPic')">
                                            <div class="disc">
                                                <div class="rpgui-container framed-grey" style="width:100%; height:100%; left:0px; top:0px;">
                                                    <label>@ViewBag.Items[index].Item.ItemInfo</label>
                                                </div>
                                            </div>
                                        </div>
                                        tempNumber += ViewBag.Items[index].quantity;
                                        index++;
                                    }
                                }
                            </div>
                        }
                    }

                </div>
            </div>
        </div>

        <div id="News">
            <a href="javascript:void(0)" onclick="document.getElementById('openNew').style.display='block';" class="Btn">
                <img id="scrollImg" src="~/student/img/scroll.png">
            </a>

            <div id="openNew" class="rpgui-content">
                <div class="rpgui-container framed rpgui-draggable" id="inventory">
                    <div>
                        <a href="javascript:void(0)" onclick="document.getElementById('openNew').style.display='none'">Close</a>
                    </div>
                    <hr>
                    <div>
                        just write something here to see
                    </div>
                </div>
            </div>
        </div>

        <div id="Shop">
            <img id="shopImg" src="~/student/img/shop.png" class="Btn" onclick="GotoShop()">
        </div>
    </div>

    <div class="RightObj">
        <a href="/student/PowerUp" class="Btn">
            <div id="Training" class="Btn"></div>
        </a>

        <a href="/student/SkillTree" class="Btn">
            <div id="skillTree"></div>
        </a>

        <a href="/student/PasswordChange" class="Btn">
            <div id="setting"></div>
        </a>
    </div>

    <form action="/Adventure/index" method="get" class="Adv">
        <button class="rpgui-button" id="AdvBtn" type="submit" style="width:100%">
            <p>Adventure!!</p>
        </button>
    </form>

    <div id="charImg">
        <img src="~/student/img/char_magician.png" style="height: 60%; top:15% ;left:7%;position: absolute;">
    </div>


    <script src="~/student//main.js"></script>

    @if(ViewBag.SkillPic != null)
    {
        <div style="display:none" id="NowSkillPic">@ViewBag.SkillPic</div>
    }
    @if(ViewBag.NowItem != null)
    {
        <div style="display:none" id="NowItemPic">@ViewBag.NowItem.ItemPic</div>
        <div style="display:none" id="NowItemInfo">@ViewBag.NowItem.ItemInfo</div>
    }
    <script>
        // 點擊商城
        function GotoShop() {
            var shop = document.createElement("form");
            shop.action = "/Student/shop";
            shop.method = "get";
            shop.style.display = "none";
            document.body.appendChild(shop);
            shop.submit();
        }
        ////

        // 現在技能圖片綁定
        var img = document.createElement("img");
        var NowSkillPic = document.querySelector("#NowSkillPic").innerText;
        img.src = `/student/img/skill_icon/${NowSkillPic}`;
        img.style.width = "100%";
        img.style.height = "100%";
        document.querySelector("#skill_col").appendChild(img);
        ////

        // 現在道具圖片綁定
        var container = document.createElement("div");
        var container2 = document.createElement("div");
        var img = document.createElement("div");
        var info = document.createElement("label");
        var NowItemPic = document.querySelector("#NowItemPic").innerText;
        var NowItemInfo = document.querySelector("#NowItemInfo").innerText;
        // 製作道具元素
        container.className = "itemImg item_001 Btn";
        container.onclick = function () {
            pdItem(this);
        }
        container.style.backgroundImage = `url(/student/xMallPic/${NowItemPic})`;
        container2.className = "disc";
        img.className = "rpgui-container framed-grey";
        img.style.width = "100%";
        img.style.height = "100%";
        img.style.left = "0px";
        img.style.top = "0px";
        info.innerText = NowItemInfo;

        container.appendChild(container2);
        container2.appendChild(img);
        img.appendChild(info);
        document.querySelector("#potion_col").appendChild(container);
        ////

        // 裝備道具 -> 回傳後端資訊data => 圖片數字，後端儲存
        function pdItem(e) {
            //// 元素 ////
            // 獲取圖片數字
            var reg = /Icon(\d*).png/;
            var elementPicture = e.style.backgroundImage;
            var data = reg.exec(elementPicture)[1];
            // 裝備道具欄位的道具
            var equipBox = document.querySelector("#potion_col div")
            /////////////////////////

            //// 布林 ////
            // 取消裝備道具
            var cancelItem = equipBox == e;
            if (cancelItem) data = 0;
            ////
            // 重複道具判定
            var repeatItem = false;
            if (equipBox != null)
                repeatItem = equipBox.style.backgroundImage == e.style.backgroundImage;

            //// 傳送後端資料 ////
            if (!repeatItem || cancelItem) {
                var rqs = new XMLHttpRequest();
                rqs.open("post", "saveNowItem");
                rqs.setRequestHeader("Content-type", "application/x-www-form-urlencoded")
                rqs.onload = function () {
                    console.log(rqs.responseText);
                }
                rqs.send(`data=${data}`);
                delete rqs;
            }
            /////////////////////////
        }

    </script>

</body>
</html>